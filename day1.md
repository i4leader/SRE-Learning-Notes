# SRE Foundation认证课程学习笔记

***


## 前言

本学习笔记为学习SRE课程时划的重点内容,本人专注做售后以及运维十多年,经过本次GOOGLE SRE理念的学习,感触非常大,所以觉得很有必要将学到的先进的理念分享给大家.
SRE是Site Relibility Engineer(站点可靠性工程师)的缩写,顾名思义,SRE是为站点可靠性负责的;如果把Devops当做研发领导的组织内部破墙的方法论,那SRE又提升了一个新的层次,就是从运维的角度去整合所有的研发,测试,运维资源.
并且它指出所有的运维问题都是软件问题的先进思想,仔细想一下还真是这样;譬如大量的重复的琐碎的工作可以通过软件工程的方法或者自动化的方法去解决那不是更好.
它还指出,SRE的工作必须保证至少50%的时间是在做系统的优化工作,为了明天更好的工作,再回看我们现在的运维,基本上重复性的工作占了大多数,很少有运维会思考明天的事情.
最令人激动的是,它指出系统的可靠性不可能是100%,它为广大运维同胞犯错以及系统宕机的存在提供了正确的理论支持,系统宕机领导再让运维背锅的时候,可以侧面的让领导看看SRE的理念,系统可靠性Google,AWS,AZURE都不可能做不到100%,并且每个月都会有错误预算时间来做一些系统优化或者维护.
再次反观目前国内很多公司,业务部门的需求,理念里面少了对业务停机时间的宽容.
总而言之,Google SRE的理念值得我们学习,也值得推广到更多的企业信息化建设中去.
## 各章节重点内容



### **模块1**:SRE原则和实践

#### 什么是SRE

1. 在运维的过程中,追求100%的可靠性是非常昂贵的,并且实现的技术也是非常复杂,大部分业务是没有必要的;所以有了错误预算的概念,运维工作必须将在规定的期限内将错误预算用完.
2. SRE主要目标是创建高可扩展和高可用的分布式软件系统
3. SRE 50%的时间做运维工作,另外50%的时间做运维平台的改进,运维工具以及运维自动化,和运维监控告警等工作
#### Devops和SRE的区别

Devops是一组旨在打破IT开发，运营，架构，网络和安全等各部门壁垒的实践，准则和文化;
SRE 是一系列行之有效的实践,有些人认为是SRE使这些实践活跃起来的的一个工作角色
总结一下就是: SRE 实现 Devops
#### SRE原则和实践

1. 原则: 运维是一个软件问题,所以SRE要用软件工程的方式去解决运维的问题
2. 服务级别
* Service Level Objective(SLO)是一个产品或者服务的可用性目标,一般来说不会是100%
* SRE 服务的管理取决于SLO
如果违反了SLO,则需要调查结果
3. 减少琐事(Toil): 对于手动,计划的运维操作和可以自动化的操作进行自动化来减少这种琐事
SRE需要有足够的时间来做系统优化的工作来使明天更好.
4. 自动化
* 自动化手动的操作
* 决定自动化什么以及如何自动化他们
* 使用工程的方法去解决问题,而不是一遍一遍的辛勤劳动
* 不要自动化一个错误的流程
SRE 团队有能力来调节他们的工作负载
5. 减少失败的成本
* 后期发现问题解决的成本更高,所以SRE会在前期就尽量避免错误
* 改善MTTR(Mean Time to Repair)
* 尽量做小的改动
* 金丝雀发布
失败是一个改进的机会
6. 共享责任人
* SRE与产品开发团队分享技能
* 去除应用开发以及产品运维部门之间的界限
* SRE 为开发团队提供运维的智慧


### **模块2**:SLO和错误预算

#### 什么是Service Level Objective(SLO)

* SLO 是一个来衡量产品或者服务运营的目标
* SLO 和用户体验紧密相关
* 设置和衡量的SLO目标是SRE角色的关键工作
* 最为广泛使用的SLO目标是可用性
* 产品和服务可以具有多个SLO
总之: SLO是为了将用户体验做的更好


#### 什么是错误预算

由于SLO不可能是100%,那如果设置服务SLO为99.9%的时候,那剩下的0.1%就叫做错误预算.如果SLO没有达到99.9%,那SRE团队就需要额外工作来找到原因以及优化以及修复SLO.
例子:如果我们的服务在一个月内收到1,000,000个请求，则99.9％的可用性SLO会为我们提供该期间1,000个错误预算。
**错误预算的好与坏**  
|坏处 |好处 |
|--|--|
|如果错误预算超过预算了,则意味着SRE团队需要加班来解决这些问题|另一方面来说,我们鼓励SRE每个月将错误预算使用完,例如打补丁或者架构调整等 |
如果SLO达不到要求,研发团队需要停止手头的开发工作,专注于优化改进SLO的事情,直到SLO达到要求.并且研发必须每天向SRE团队汇报每天的进展.
**可用性和错误预算示例表**

|可用性|错误预算(一个月)|
|--|--|
|99%|432分钟|
|99.9%|43.2分钟|
|99.99%|4.3分钟|
|99.999%|4秒|


### **模块3**:减少琐事

#### 什么是琐事(Toil)

琐事的定义:
琐事是与运行生产服务相关的一种工作，往往是手工的，重复的，可自动化的，战术的，没有持久价值的，并且随着服务的增长呈线性扩展。 --Vivek Rau, Google
以下是琐事的一些特征:
* 手动
* 手动或者半手动的发布
* 连接到基础架构去检查某些东西
* 经常性的密码重置
* 重复性的工作
* 一遍遍做相同的测试
* 每天早上去确认同一个错误
* 可自动化的
* 产品部署会议
* 手动开始或者重置设备或者组件
* 创建用户
* 非战术/反应式
* 已知的工作变通,例如空间不够,资源不足
* 值班响应
* 没有可持续性的价值
* 导出一些数据
* 手动扩缩容
* 手动扩缩容环境


#### 什么不是琐事

* 常规工作例如设置一台新的设备,开发一个新的服务告警以及移除集群等;
* 会议, 社区活动, 规划相关的事情,HR相关事情


#### 为什么琐事不好?

|琐事较多的影响|对于个人而言|对于组织来言|
|---|---|---|
|进程缓慢|手动工作以及救急相关工作占据了大部分时间|新功能没有办法快速发布,错过价值机会,团队人手紧张|
|质量差|手动的工作经常会导致错误,并且会费时间去解决,影响声誉|服务支持超过成本|
|职业生涯停滞|大部分的重复性工作会导致职位生涯的停滞不前,没有时间发展技能,最好的工程师干最低端的活|声誉受到伤害,不是一个好的工作地,员工离职率变高|
|损耗的|琐事会让人觉得无心工作|人员流动会导致额外费用和知识流失|
|永无止境|没有时间去找解决方法,更多的时间花在解决积压的工作上|琐事需要工程团队去解决,如果没有可用的工程团队的时间,那这个问题永远也解决不了.SLA即将被违反.|
|燃尽|过载工作会导致个人和健康问题|潜在的纠纷和负面宣传|
总之一句话,当琐事多到一定程度;那离工程破产就不远了.
#### 如何减少琐事?

* 减少琐事需要工程团队时间
* 需要选择以下工程开发工作:
* 创建外部自动化(例如:服务外的脚本以及自动化工具)
* 创建内部自动化(服务内的自动化)
* 增强自服务


### **模块4**:监控以及SLI

#### 什么是Service Level Indicators(SLI)

SLI是工程师为了和系统交流的量化数据.
监控SLI能告诉我们SLO是否满足期望,它也能告诉我们error buget还剩多少.
一般来说SLI会被认为是一个比率,好的事件数量除以所有的事件数量.
例如: 成功的HTTP请求数量/所有的HTTP请求数量(HTTP请求成功率)


#### 什么是监控

##### Monitoring(监控)

系统监控是试用软件或者硬件去监控计算机系统资源和性能情况


##### (Telemetry)遥测技术

遥测是一种高度自动化的通信过程，通过该过程可以进行测量并在远程或无法访问的点处收集其他数据，并将其传输到接收设备以进行监视。


##### (Application Performance Monitoring)应用性能管理

应用程序性能监视是监视和管理软件应用程序的性能和可用性。 APM努力检测和诊断应用程序性能问题，以维持预期的服务水平.


#### 监控又分为四个部分

监控 - 工具举例: Nagios, Splunk, Prometheus
图形演示以及报表 - 工具举例: Granfana, Collectd
日志 - 工具举例: Logstash, Rsyslog, Collectd
告警 - 工具举例: Pager


#### Monitoring(监控) 和 Observability(可观测性)

* 分布式，复杂的服务，无法预测的用户和可变的吞吐量在大规模运行着，这意味着有数百万种出错的可能
* 但是我们无法预测到所有的出错的可能
* 将服务的所有状态都输出到外部,使得我们能够推断服务的内部状态


#### 为什么可观测性很重要

* 服务快速增长
* 动态架构
* 容器的负载
* 服务之间的依赖关系
* 关系到客户体验


#### 可观测性应该包含如下内容

* 分布式跟踪
* 事件日志
* 内部性能数据
* 应用仪器
* 识别单个用户体验
* 少而精的警告
* SLO/SLi的客观测性
对于告警,Google SRE的理念为只告警最重要的信息,这可以保证告警的有效性;如果你每天都能收到上百上千甚至上万条告警,那这样的告警是无效的.你也是不会看的​。​



这是第一天SRE Foundation培训的的分享,第二天的内容我再做一些整理后再分享出来.


如果你们喜欢,请点赞以及转发.
